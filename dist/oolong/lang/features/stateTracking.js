'use strict';const inflection=require('inflection'),Util=require('../../../util.js'),_=Util._,FEATURE_NAME='stateTracking';function initialize(entity,options){if(!options){throw new Error('Missing field options!')}if('string'===typeof options){options={field:options}}if(!options.field){throw new Error('Missing field name in options!')}let stateSetTimestamp={type:'datetime',range:'timestamp',auto:true,optional:true};if(!options.reversible){stateSetTimestamp.fixedValue=true}entity.addFeature(FEATURE_NAME,{field:options.field},true).on('afterFields',()=>{if(!entity.hasField(options.field)){throw new Error('Field "'+options.field+'" does not exist!')}let fieldInfo=entity.fields[options.field];if('enum'!==fieldInfo.type){throw new Error('Only enum field can be used with stateTracking feature!')}fieldInfo.values.forEach(state=>{let fieldName=options.field+inflection.camelize(state)+'Timestamp';entity.addField(fieldName,stateSetTimestamp)})})}module.exports=initialize;