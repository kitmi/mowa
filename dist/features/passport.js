'use strict';const path=require('path'),Mowa=require('../server.js'),Util=Mowa.Util,Promise=Util.Promise,KoaPassport=require('koa-passport').KoaPassport;module.exports={type:Mowa.Feature.SERVICE,load_:function(appModule,config){if(appModule.serverModule.options.deaf)return Promise.resolve();let passport=new KoaPassport;if(Util._.isEmpty(config)||!config.strategies){throw new Mowa.Error.InvalidConfiguration('Missing passport strategies.',appModule,'passport.strategies')}appModule.registerService('passport',passport);let strategies=Array.isArray(config.strategies)?config.strategies:[config.strategies];return Util.eachAsync_(strategies,async strategy=>{let strategyScript=path.join(appModule.backendPath,'passports',strategy+'.js'),strategyInitiator=require(strategyScript);return strategyInitiator(appModule,passport)})}};