'use strict';require('debug')('tracing')(__filename);const Util=require('../util.js');module.exports={type:Util.Feature.ROUTING,load:function(appModule,routes){let promises=[];let result=Promise.resolve();Util._.forOwn(routes,function(routersConfig,route){let mount=route;if(Util._.isObject(routersConfig)){Util._.forOwn(routersConfig,function(options,type){if(appModule.serverModule.options.deaf&&type!=='mod'){return}let loader=require('../routers/'+type+'.js');promises.push(()=>{appModule.log('verbose',`A "${type}" router is created at "${mount}" in module [${appModule.name}].`);return loader(appModule,mount,options)})})}else{if(appModule.serverModule.options.deaf){return}let rules={};rules['/']=routersConfig;let loader=require('../routers/rule.js');promises.push(()=>{appModule.log('verbose',`A "rule" router is created at "${mount}" in module [${appModule.name}].`);return loader(appModule,mount,{rules:rules})})}});promises.forEach(promiseGenerator=>{result=result.then(promiseGenerator)});return result}};