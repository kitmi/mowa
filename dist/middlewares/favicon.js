'use strict';const Mowa=require('../server.js'),Util=Mowa.Util,_=Util._,fs=Util.fs,path=require('path');let favicon=(options,appModule)=>{let faviconPath;if(_.isString(options)){faviconPath=options;options={}}else{faviconPath=options.path||path.join(appModule.frontendStaticPath,'favicon.ico')}let icon;const maxAge=null==options.maxAge?86400000:Math.min(Math.max(0,options.maxAge),31556926000),cacheControl=`public, max-age=${0|maxAge/1000}`;return async(ctx,next)=>{if('/favicon.ico'!==ctx.path){await next();return}if(!icon){let stats=await fs.stat(faviconPath);if(1048576<stats.size){appModule.log('warn','favicon.ico too large.',stats);ctx.throw(Mowa.HttpCode.HTTP_NOT_FOUND)}icon=await fs.readFile(faviconPath)}ctx.set('Cache-Control',cacheControl);ctx.type='image/x-icon';ctx.body=icon}};favicon.__metaMatchMethods=['get','head'];module.exports=favicon;