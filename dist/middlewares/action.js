'use strict';const Mowa=require('../server.js'),Util=Mowa.Util,_=Util._,path=require('path');module.exports=(controllerAction,appModule)=>{if(!_.isString(controllerAction)){throw new Mowa.Error.InvalidConfiguration('Invalid action syntax.',appModule)}let pos=controllerAction.lastIndexOf('.');if(0>pos){throw new Mowa.Error.InvalidConfiguration(`Unrecognized controller & action syntax: ${controllerAction}.`,appModule)}let controller=controllerAction.substr(0,pos),action=controllerAction.substr(pos+1),controllerBasePath=path.join(appModule.backendPath,Mowa.Literal.CONTROLLERS_PATH),controllerPath=path.resolve(controllerBasePath,controller+'.js'),ctrl=require(controllerPath),actioner=ctrl[action];if('function'!==typeof actioner){throw new Mowa.Error.InvalidConfiguration(`${controllerAction} is not a valid action.`,appModule)}return async(ctx,next)=>{appModule.prepareActionContext(ctx);await actioner(ctx);return next()}};