'use strict';require('debug')('tracing')(__filename);const AppModule=require('../appmodule.js');const path=require('path');module.exports=function loadModRouter(appModule,baseRoute,config){if(!config.name){appModule.invalidConfig('routes.*.mod','Missing module name.')}let options=Object.assign({verbose:appModule.options.verbose},config.options);if(options.npmModule&&!options.modulePath){options.modulePath=path.join('node_modules',config.name)}let mod=new AppModule(appModule,config.name,baseRoute,options);mod.settings=config.settings||{};let relativePath=path.relative(appModule.serverModule.absolutePath,mod.absolutePath);appModule.log('verbose',`Loading web module [${mod.name}] from "${relativePath}"`);return mod.start(config.features).then(()=>{appModule.log('verbose',`App [${mod.name}] is loaded.`);appModule.addChildModule(baseRoute,mod)}).catch(reason=>{appModule.log('error',`Failed to load app [${mod.name}]`);throw reason})};