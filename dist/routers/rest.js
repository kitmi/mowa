'use strict';const path=require('path');const Mowa=require('../server.js');const Util=Mowa.Util;const _=Util._;const Router=require('koa-router');module.exports=function(appModule,baseRoute,options){let resourcePath=path.join(appModule.backendPath,Mowa.Literal.RESOURCES_PATH);let router=baseRoute==='/'?new Router:new Router({prefix:baseRoute});if(options.middlewares){appModule.useMiddlewares(router,options.middlewares)}let ctrlsMap=new Map;let resourcesPath=path.join(resourcePath,'*.js');let files=Util.glob.sync(resourcesPath,{nodir:true});_.each(files,file=>{let urlName=Util.S(path.basename(file,'.js')).underscore().s;ctrlsMap.set(urlName,require(file))});appModule.addRoute(router,'get','/:resource',{restAction:{type:'query',controllers:ctrlsMap}});appModule.addRoute(router,'post','/:resource',{restAction:{type:'create',controllers:ctrlsMap}});appModule.addRoute(router,'get','/:resource/:id',{restAction:{type:'get',controllers:ctrlsMap}});appModule.addRoute(router,'put','/:resource/:id',{restAction:{type:'update',controllers:ctrlsMap}});appModule.addRoute(router,'del','/:resource/:id',{restAction:{type:'delete',controllers:ctrlsMap}});appModule.addRouter(router);return Promise.resolve()};