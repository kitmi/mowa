'use strict';const path=require('path'),Mowa=require('../server.js'),Util=Mowa.Util,_=Util._,Promise=Util.Promise,Router=require('koa-router');module.exports=async(appModule,baseRoute,options)=>{let resourcePath=path.join(appModule.backendPath,Mowa.Literal.RESOURCES_PATH),router='/'===baseRoute?new Router:new Router({prefix:baseRoute});if(options.middlewares){appModule.useMiddlewares(router,options.middlewares)}let ctrlsMap=new Map,resourcesPath=path.join(resourcePath,'*.js'),files=Util.glob.sync(resourcesPath,{nodir:true});_.each(files,file=>{let urlName=Util.S(path.basename(file,'.js')).underscore().s;ctrlsMap.set(urlName,require(file))});appModule.addRoute(router,'get','/:resource',{restAction:{type:'query',controllers:ctrlsMap}});appModule.addRoute(router,'post','/:resource',{restAction:{type:'create',controllers:ctrlsMap}});appModule.addRoute(router,'get','/:resource/:id',{restAction:{type:'detail',controllers:ctrlsMap}});appModule.addRoute(router,'put','/:resource/:id',{restAction:{type:'update',controllers:ctrlsMap}});appModule.addRoute(router,'delete','/:resource/:id',{restAction:{type:'remove',controllers:ctrlsMap}});appModule.addRouter(router)};