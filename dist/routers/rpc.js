'use strict';const path=require('path'),Util=require('../util.js'),Promise=Util.Promise,Router=require('koa-router'),inflection=require('inflection');module.exports=function loadRpcRouter(appModule,baseRoute,options){options=Object.assign({controllers:path.join(appModule.backendPath,'rpc')},options);let router='/'===baseRoute?new Router:new Router({prefix:baseRoute});if(options.middlewares){appModule.useMiddlewares(router,options.middlewares)}let ctrlsMap=new Map,controllersPath=appModule.toAbsolutePath(options.controllers,'*.js'),files=Util.glob.sync(controllersPath,{nodir:true});Util._.each(files,file=>{let urlName=Util.S(path.basename(file,'.js')).slugify().s;ctrlsMap.set(urlName,require(file))});appModule.addRoute(router,'post','/:controller',{remoteCall:{controllers:ctrlsMap}});appModule.addRouter(router);return Promise.resolve()};